addons:
apt:
update: true

language: cpp

stages:
  - style
  - build
  - memcheck
  - unit_test

before_install:
- sudo apt update

style:
  stage: style
  install: sudo apt install cppcheck
  script: cppcheck .

build:
  stage: build
  install:
  - sudo apt install cmake
  - sudo apt install libgtest-dev
  - cd /usr/src/gtest
  - sudo cmake CMakeLists.txt
  - sudo make
  - sudo cp *.a /usr/lib
  - cd -
  script:
  - mkdir build
  - cd build
  - cmake .. -DCMAKE_BUILD_TYPE=$BUILD_CONFIGURATION -DTARGET_CPU=$TARGET_CPU
  - cmake --build .
  - make

memcheck:
  stage: memcheck
  install: sudo apt install valgrind
  script: valgrind --tool=memcheck ./lab_01/lab_01.exe -memcheck

unit_test:
  stage: unit_test
  script: ./lab_01/test_01.exe
  after_script: make clean
